#include <Servo.h>
//definimos los pines del sensor de distancia
const int trigPin = 8;
const int echoPin = 11;
const int trigPinL = 4;
const int echoPinL = 5;
const int trigPinR = 6;
const int echoPinR = 7;

// definir pines del motor 

const int enA = 9;
const int in1 = 2;
const int in2 = 3;

//definimos el servomotor
const int servoPin = 10;
Servo steeringServo;

void setup() {
  //definimos salida del sensor de distancia
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);
  
  //definir salidas de puente H
  pinMode(enA, OUTPUT);
  pinMode(in1, OUTPUT);
  pinMode(in2, OUTPUT);

  //definir servo motor
  steeringServo.attach(servoPin);
  
  Serial.begin(9600);
}

void loop() {
  long duration, distance;
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  duration = pulseIn(echoPin, HIGH);
  distance = duration * 0.034 / 2;
  
  //imprimimos en el puerto serial
  Serial.print("Distance: ");
  Serial.println(distance);

  if (distance < 45) {
    // Apaga Motor
    digitalWrite(in1, LOW);
    digitalWrite(in2, HIGH);
    Serial.print("Freno");

    delay(50);
       digitalWrite(in1, LOW);
    digitalWrite(in2, LOW);
    // Turn left
    steeringServo.write(70); // Ajustamos el angulo necesario
    delay(100);
    digitalWrite(enA, HIGH);
    digitalWrite(in1, HIGH);
    digitalWrite(in2, LOW);
    Serial.print("Giro Izquierda 1");
    delay(500);

    steeringServo.write(130);
    digitalWrite(enA, HIGH);
    digitalWrite(in1, LOW);
    digitalWrite(in2, HIGH);
    delay(500);
     Serial.print("Giro Derecha Atras 1");

     steeringServo.write(70); // Ajusta el ángulo según sea necesari    
    delay(100);
    digitalWrite(enA, HIGH);
    digitalWrite(in1, HIGH);
    digitalWrite(in2, LOW);
    delay(500);
    Serial.print("Giro Izquierda alante 2");

    steeringServo.write(130);
    digitalWrite(enA, HIGH);
    digitalWrite(in1, LOW);
    digitalWrite(in2, HIGH);
    Serial.print("Giro derecha atras 2");
    delay(500);

         steeringServo.write(70); // Ajusta el ángulo según sea necesari    
    delay(100);
    digitalWrite(enA, HIGH);
    digitalWrite(in1, HIGH);
    digitalWrite(in2, LOW);
    delay(500);
    Serial.print("Giro Izquierda alante 3");

    steeringServo.write(130);
    digitalWrite(enA, HIGH);
    digitalWrite(in1, LOW);
    digitalWrite(in2, HIGH);
    Serial.print("Giro derecha atras 3");
    delay(500);




  } else {
    // Move forward
    steeringServo.write(90);
    digitalWrite(enA,HIGH);
    digitalWrite(in1, HIGH);
    digitalWrite(in2, LOW);

  }
  
  delay(100);
}
